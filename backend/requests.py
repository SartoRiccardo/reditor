from credentials import Reddit, Amazon, Twitter
import json
import urllib3
import urllib.parse
import os
import hashlib
import hmac
import datetime
import praw
import twitter
import backend.editor


http = urllib3.PoolManager()
VOICES = {
    "male-2": "Joey",
    "male-1": "Matthew",
    "female-1": "Kendra",
    "female-2": "Kimberly",
}
MAX_RATIO = 3/2
MIN_RATIO = 1/MAX_RATIO


class ImageLink:
    def __init__(self, path, is_url):
        self.path = path
        self.is_url = is_url


class IntVar:
    def __init__(self, val=0):
        self.val = val

    def __add__(self, other):
        return self.val + other

    def __iadd__(self, other):
        self.val += other
        return self

    def __sub__(self, other):
        return self.val - other

    def __isub__(self, other):
        self.val -= other
        return self

    def __gt__(self, other):
        return self.val > other

    def __ge__(self, other):
        return self.val >= other

    def __eq__(self, other):
        return self.val == other

    def __lt__(self, other):
        return self.val < other

    def __le__(self, other):
        return self.val <= other

    def __str__(self):
        return str(self.val)


def subreddit_image_posts(sub, only_selfposts=False, max_scenes=100000):
    """
    Fetches a subreddit's top submissions.
    :param sub: str: The name of the subreddit.
    :param only_selfposts: boolean: Whether to only get selfposts/comments.
    :param max_scenes: int: Max number of posts to download.
    :return: ImageLink[]: A list of URLs leading to the images.
    """
    reddit = praw.Reddit(
        client_id=Reddit.client_id,
        client_secret=Reddit.client_secret,
        user_agent=Reddit.user_agent,
        check_for_updates="False",
        comment_kind="t1",
        message_kind="t4",
        redditor_kind="t2",
        submission_kind="t3",
        subreddit_kind="t5",
        trophy_kind="t6",
        oauth_url="https://oauth.reddit.com",
        reddit_url="https://www.reddit.com",
        short_url="https://redd.it"
    )
    reddit.read_only = True

    try:
        submission_lists = [reddit.subreddit(sub).top("week"), reddit.subreddit(sub).hot()]

        ret = []
        for submissions in submission_lists:
            for s in submissions:
                if len(ret) >= max_scenes:
                    break

                if s.over_18 or s.stickied:
                    continue

                if not only_selfposts and hasattr(s, "post_hint") and s.post_hint == "image":
                    source = s.preview["images"][0]["source"]
                    image_url = s.preview["images"][0]["source"]["url"]
                    if MIN_RATIO <= source["width"]/source["height"] <= MAX_RATIO and \
                            image_url not in ret:
                        ret.append(ImageLink(image_url, True))
                elif s.is_self:
                    image = backend.image.reddit_to_image(s, sub)
                    if image:
                        ret.append(ImageLink(image, False))

        return ret

    except Exception as ex:
        print(ex)
        return []


def post_comments(thread_id):
    """
    Fetches a subreddit's top submissions.
    :param thread_id: str: The ID of the thread.
    :return: ImageLink[]: A list of URLs leading to the images.
    """
    reddit = praw.Reddit(
        client_id=Reddit.client_id,
        client_secret=Reddit.client_secret,
        user_agent=Reddit.user_agent,
        check_for_updates="False",
        comment_kind="t1",
        message_kind="t4",
        redditor_kind="t2",
        submission_kind="t3",
        subreddit_kind="t5",
        trophy_kind="t6",
        oauth_url="https://oauth.reddit.com",
        reddit_url="https://www.reddit.com",
        short_url="https://redd.it"
    )
    reddit.read_only = True

    try:
        ret = []
        submission = reddit.submission(thread_id)
        path = backend.image.reddit_to_image(submission, submission.subreddit.id)
        if path:
            ret.append(ImageLink(path, is_url=False))

        # comments = get_simplified_comments(submission.comments)
        comments = [{'author': 'Tacticalbiscit', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_2.png', 'body': 'As a dog owner and cat owner I sometimes look at them and think, "there is literally an animal living in my house whose ancestors ran free and hunted other animals and it is just laying upside down all cute on its bed beside me and also can\'t eat unless I give it food". So I guess that.', 'score': 14436, 'replies': [{'author': 'yeet_and_defeat', 'author_pfp': 'https://styles.redditmedia.com/t5_378ryy/styles/profileIcon_snoo0db4d2ee-7338-4943-8a4c-9b4335f95260-headshot-f.png?width=256&height=256&crop=256:256,smart&s=caeab238df62798c857c3c1b2aeada7ce6337489', 'body': 'I always look at my cat and think about how stupid I must be. One day I was all like “hey, you’re cute and furry! So come live in my house, scratch up my mats, vomit on my couch and leave hair absolutely everywhere while I spend my time and money caring for you”', 'score': 4775, 'replies': [{'author': 'Ninotchk', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_6.png', 'body': 'And then it twists in its sleep to expose that soft tummy fur...', 'score': 1125, 'replies': [{'author': 'Dr_Silk', 'author_pfp': 'https://styles.redditmedia.com/t5_e7x0e/styles/profileIcon_3kh1uhn3nld71.jpg?width=256&height=256&crop=256:256,smart&s=ea3135e61206cb573d20de4a7783f0fa6ade9d5e', 'body': 'Worth it', 'score': 498, 'replies': [{'author': 'navikredstar', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_1.png', 'body': 'My cat, Cleo, legitimately *looooooves* belly rubs and even lets me stick my face in her belly fur without getting overstimulated and gently nipping me. If she has enough, she just rolls back over and gives me a look like, "Okay I\'m good now."\n  \nShe\'s a delightfully manipulative little shit, and I wouldn\'t have it any other way, though. Especially when she gets *so* excited and happy to see me at the door when I come in after work, or when she wants to come lay on my chest with her face as close to mine as she can get, and just lay there with the cat equivalent of a beaming smile so I can kiss her head and hold her to me. And she legit loves to be gently hugged to me, she cuddles and leans into it. Cats are fucking awesome.', 'score': 37, 'replies': []}]}]}]}]}, {'author': 'Lurkwurst', 'author_pfp': 'https://styles.redditmedia.com/t5_10ke9d/styles/profileIcon_lp7bobh92jv71.jpg?width=256&height=256&crop=256:256,smart&s=33a0facfab0f8a04c83bca5d0dcef09c8fb1fd23', 'body': 'Gravity', 'score': 12386, 'replies': [{'author': 'lu3go', 'author_pfp': 'https://styles.redditmedia.com/t5_2px6oo/styles/profileIcon_snoo1be91cb3-4f42-4e05-9570-5a8adc800999-headshot-f.png?width=256&height=256&crop=256:256,smart&s=41c04e7cfa34db90c47caba9399ec922840a4113', 'body': "it's working against me", 'score': 4923, 'replies': [{'author': 'JustMeZach', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_3.png', 'body': 'I wish it’d stay the hell away from me', 'score': 197, 'replies': [{'author': 'laserlax23', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_7.png', 'body': 'Dream of ways to throoow it all away', 'score': 79, 'replies': []}]}, {'author': 'DethNik', 'author_pfp': 'https://styles.redditmedia.com/t5_ce2dn/styles/profileIcon_snoo0908a65f-c62d-4db8-ba31-0c63c96fa68f-headshot.png?width=256&height=256&crop=256:256,smart&s=2d300c947c9227045a55ea1813caca3042b7bb1f', 'body': 'Woahohh gravity', 'score': 85, 'replies': []}]}]}, {'author': 'RedstoneRelic', 'author_pfp': 'https://styles.redditmedia.com/t5_94jl4/styles/profileIcon_snoo404ad193-9545-4c58-9456-372124e4abb1-headshot-f.png?width=256&height=256&crop=256:256,smart&s=c54c802667a250e4cc3b784cb1b163fa697aa777', 'body': "Cheering in a crowd. I just can't bring myself to woooooooo!", 'score': 909, 'replies': [{'author': 'gatemansgc', 'author_pfp': 'https://styles.redditmedia.com/t5_1gp8k5/styles/profileIcon_6b7mt4f7rhp41.png?width=256&height=256&crop=256:256,smart&s=b783b0c8bda0fb5398ed05cf4d5a925815f7e802', 'body': "Wait 'til the wave passes through", 'score': 38, 'replies': []}, {'author': 'iambfizzle', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_4.png', 'body': 'Alcohol', 'score': 28, 'replies': []}]}, {'author': 'TechnicallyNotRon_', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_3.png', 'body': 'the entire concept of laughter. why does our face contort and our diaphragm spasm when certain things happen? and how do our brains decide what things are funny and what things aren’t?', 'score': 17759, 'replies': [{'author': 'red_fuel', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_1.png', 'body': 'I once saw a documentary that studied laughter in apes. They said that it was a reaction for when someone makes a mistake but it doesn’t matter/isn’t anything serious. Kinda makes sense to me', 'score': 5289, 'replies': [{'author': 'Open_Regular90210', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_2.png', 'body': 'We scream to alert others of danger or that we need help so laughter is a way of following it up with "false alarm." How many times have you laughed to yourself after being startled over something trivial? It\'s basically that. An unexpected outcome also makes us laugh. That\'s why jokes work.', 'score': 3890, 'replies': [{'author': 'bushcrapping', 'author_pfp': 'https://styles.redditmedia.com/t5_12cy5m/styles/profileIcon_snoo99eefc0a-42da-4c79-aaeb-f9ced4f9d6b8-headshot-f.png?width=256&height=256&crop=256:256,smart&s=38ddefbb47690389da612e53f2d5ad56bb9ef2c9', 'body': "In a similar vein it's a way to show that you are play fighting. Even rats will laugh while play fighting.", 'score': 1172, 'replies': [{'author': 'SenorVilla', 'author_pfp': 'https://styles.redditmedia.com/t5_2c37hf/styles/profileIcon_snoo393648ec-2780-4ad8-8cee-1adbaac0209a-headshot.png?width=256&height=256&crop=256:256,smart&s=7b29e1ae86c585f7d01a7711404c507d75c1b251', 'body': 'So it\'s just the primordial way of saying "just a prank, bro"', 'score': 1138, 'replies': []}]}]}]}]}, {'author': 'pleasegivemealife', 'author_pfp': 'https://styles.redditmedia.com/t5_es3k7/styles/profileIcon_snoofae25d21-bc8f-4b70-b64b-ccfec2894a63-headshot.png?width=256&height=256&crop=256:256,smart&s=d61dcf627486b289df2a4dcc3e5b4b2767f66487', 'body': "Our stomach naturally produces hydrochloric acid. It's corrosive and can burn through your skin and tissues. Bbuuuuutttr our stomach lining is covered in mucus to prevent us from eating inside out.\n\n\nHave you seen hydrochloric in a science experiment? That chemical reaction is insane! Makes sense as we eat meat, bones and catrilage sometimes. If not our poop is gonna be bony...", 'score': 11439, 'replies': [{'author': 'Raw-Sewage', 'author_pfp': 'https://styles.redditmedia.com/t5_25qgl2/styles/profileIcon_k0oyjf03inr61.jpg?width=256&height=256&crop=256:256,smart&s=d8a868e7e3ad55a895b1e4cfd378cd1380c91ba0', 'body': 'The stomach lining replaces itself every day with a fresh set of cells. Imagine being born into the world only to find out your only purpose is in life to use your body as a disposable structual unit for holding acid.', 'score': 4771, 'replies': [{'author': 'Joscientist', 'author_pfp': 'https://styles.redditmedia.com/t5_c242j/styles/profileIcon_snoo07f0b44e-d654-4a0c-8453-31718c599784-headshot-f.png?width=256&height=256&crop=256:256,smart&s=a31baf872de32f9bce6f00ff03f695fcc14ff3a2', 'body': 'They live their best life. Fulfilling their purpose with gusto.', 'score': 729, 'replies': []}, {'author': 'thatlasstho', 'author_pfp': 'https://styles.redditmedia.com/t5_6xx46/styles/profileIcon_snoo684da3e8-849c-4590-9243-c2b9f0a1fb5e-headshot-f.png?width=256&height=256&crop=256:256,smart&s=1a5fc2452a89d3d94dd1af1c2105eb8dc9327179', 'body': 'Gotta say, I’m loving your seemingly random (and enlightening) comments in this thread.', 'score': 208, 'replies': []}, {'author': 'psinguine', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_1.png', 'body': 'Bodies are fuckin weird man. All these specialized structures, made of specialized cells, that all just sort of start and stop where they\'re supposed to and work for the benefit of the Hive that is the collective body. Your consciousness isn\'t even *most* of your brain. The human brain is like three other animal brains stacked on top of eachother and most of it just sort of runs itself in the background. Most of it we don\'t even have Admin Access to. Your mind, whatever it is that makes you "You", the Pilot of this walking machine made of meat, is little more than a bundle of electricity and chemicals residing on one hemisphere of that weird lump of fat in the skull. You are just one member of the massive symbiotic multi-organism that is Your Body. \n\nWhat do mitochondria think is going on? Do they think? They\'re an entirely alien creature that lives in every cell in our bodies because that\'s their habitat. Can a T-Cell be said to be alive in the same way that foreign bacteria would be? The same things they hunt and kill in the battlefield of your bloodstream? Consider a sperm cell, a highly specialized cell that shares so little of your genetic structure that your own body doesn\'t recognize it. Some men become sterile after testicular injury; the barrier is broken and the immune system becomes aware of these strange doppelgangers that only share half your genetic information. \n\nIt\'s so damn weird. And then there\'s how You don\'t actually experience the world around you. "You" are trapped in a Five Nights At Freddy\'s control room, hooked up to cameras and microphones, interacting with the world through a meat golem equipped with pressure sensors.', 'score': 94, 'replies': []}]}]}, {'author': 'Mood_Kaonashi', 'author_pfp': 'https://styles.redditmedia.com/t5_27jb85/styles/profileIcon_snoo5e248f6a-0c50-4b39-ad78-aeb7ef6c4982-headshot.png?width=256&height=256&crop=256:256,smart&s=76ccc594f1c847deb89e24644faa991b1c984657', 'body': 'Some mold is edible. No matter how stinky it is.', 'score': 16995, 'replies': [{'author': 'Au_Uncirculated', 'author_pfp': 'https://styles.redditmedia.com/t5_2586tu/styles/profileIcon_snoo3444016a-f7bb-490c-a36e-21c0d18ff9d6-headshot-f.png?width=256&height=256&crop=256:256,smart&s=dd0847296de12f6917a63823d6c1ba6f09460d67', 'body': 'Even crazier is how mold has shaped modern medicine. The romans used to put moldy bread on wounds which then developed into modern day penicillin.', 'score': 1863, 'replies': [{'author': 'PM_ME_UR_Definitions', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_6.png', 'body': 'Originally it was difficult to mass produce penicillin because the yield from the mold they originally had was so low. But researchers made a huge breakthrough when they discovered a new strain of mold that was much more productive, "the strain eventually became the primogenitor for almost all of the world’s penicillin."\n\nThey discovered the new mold on an overripe cantaloupe they bought in a fruit market near their lab in Peoria Illinois.\n\nAfter they scraped the mold off to culture it, [they ate the cantaloupe!](https://www.historynet.com/here-is-where-penicillin-comes-to-peoria.htm)', 'score': 1113, 'replies': [{'author': 'Sir-Simon-Spamalot', 'author_pfp': 'https://styles.redditmedia.com/t5_sutrs/styles/profileIcon_snoo1b76f469-ff60-4d9f-bee3-c6946faeafea-headshot-f.png?width=256&height=256&crop=256:256,smart&s=84f94689e0e77861990e9ecbb574ed63f4a7aab0', 'body': 'Yum, medicinal rotting cantaloupe', 'score': 299, 'replies': [{'author': 'TheCovfefeMug', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_2.png', 'body': '/r/bandnames', 'score': 25, 'replies': []}]}]}]}]}, {'author': 'ScrotusMahotus', 'author_pfp': 'https://styles.redditmedia.com/t5_2yuid2/styles/profileIcon_snoo58c3fecc-85c4-48e3-94bb-f389fcf5f038-headshot.png?width=256&height=256&crop=256:256,smart&s=64b61050d2bae445d414288219abaf0e28224e08', 'body': 'Dancing. Like people flail around in weird and awkward ways to sounds.', 'score': 5010, 'replies': [{'author': 'heavenupsidedownn', 'author_pfp': 'https://styles.redditmedia.com/t5_2xtbpi/styles/profileIcon_snoo9d92434c-27f4-48a5-a6ab-51f785280ee1-headshot.png?width=256&height=256&crop=256:256,smart&s=6ad0f650f643b8d58eb751aaf20d0f500126c253', 'body': '*squeaky tennis shoe noises*', 'score': 1267, 'replies': [{'author': 'FingerTheCat', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_5.png', 'body': 'Tap dancing is weird too... someone found out if they hit the ground very fast with their feet making a clicking noise they can dance with it.', 'score': 29, 'replies': []}]}, {'author': 'jah_chill', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_2.png', 'body': "I think of music in the same way. Why is patterns and tones in sound so universal as a species for us. Not matter what culture you go to at what time they'll have a type of music. Like wtf, why??? I absolutely love music but have no idea why", 'score': 461, 'replies': [{'author': 'ScrotusMahotus', 'author_pfp': 'https://styles.redditmedia.com/t5_2yuid2/styles/profileIcon_snoo58c3fecc-85c4-48e3-94bb-f389fcf5f038-headshot.png?width=256&height=256&crop=256:256,smart&s=64b61050d2bae445d414288219abaf0e28224e08', 'body': "Yeah that's one of the things I wonder about while sitting on the toilet. I have no clue how it just became a thing.", 'score': 47, 'replies': []}]}]}, {'author': 'Vinny_Lam', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_1.png', 'body': 'Languages, or just talking in general. The fact that we’ve given meaning to a bunch of random sounds made by our vocal chords is bizarre when you think about it. Like, how did this even start? How were we able to decide what should be called what? For example, how did we decide that a rock is called a rock or that the sky is called the sky?', 'score': 12964, 'replies': [{'author': 'boulomai_mathein', 'author_pfp': 'https://styles.redditmedia.com/t5_3rg6sq/styles/profileIcon_snoob3e1f4ee-2320-4d62-8fe7-d0e558cba95e-headshot-f.png?width=256&height=256&crop=256:256,smart&s=aeac98e63ae1dd4dfeab4a1e2f2ff23b40bf5fba', 'body': "The [origin of language](https://en.wikipedia.org/wiki/Origin_of_language) is an unsolved problem in linguistics that will most likely remain forever unresolved, insofar as no written records are thought to exist of it. It's wondrous to speculate about", 'score': 5381, 'replies': [{'author': 'JoieDe_Vivre_', 'author_pfp': 'https://styles.redditmedia.com/t5_chdxf/styles/profileIcon_snood853359d-5c69-46b9-905b-6f7074159bff-headshot.png?width=256&height=256&crop=256:256,smart&s=12e37f03cbf7f3aa3f417be4248b7794fdfd04b6', 'body': 'I like to think about it like bootstrapping in programming. If we can establish even a few basic words, we can leverage that to develop more. So on and so forth.', 'score': 1824, 'replies': [{'author': 'haditwithyoupeople', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_4.png', 'body': 'This. When I was a kid I had a cousin that was about the same age. We hung out all the time and were inseparable for a few years. After a few long car trips together we started to create our own language. I *think* this was so other people wouldn\'t know what were were talking about, but don\'t recall. We could do a fair amount of communication with relatively few words (maybe 30 or 40?).\n\nThe "so what" of this is that the specific sounds were not terribly important - just the agreement on the meaning. At the time this was silly and fun. Much later in life it occurs to me that it is perhaps not to difficult to start a rudimentary language. Of course, we already spoke a language so our brains didn\'t have to figure that out', 'score': 1307, 'replies': [{'author': 'Mollybrinks', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_3.png', 'body': 'Soooo apparently my older brother (2 years older) didn\'t talk for years, except in gibberish. I translated for him. It makes sense in retrospect....I was apparently leveraging the same abilities to understand him as I was to understand literally everyone else in the world. It tells me that his "language" was probably cohesive (since I could reliably interpret it) but entirely made up. It gave me an insight into how my own brain developed, but mind blown on how his did - he either totally didn\'t get what was being said around him (so he made up his own language and  I picked it up on his behalf) OR he did but just rejected it - like, I know you\'re saying cookie, but I believe it should be knock knock so I\'m just gonna go with my version instead. When he did eventually start talking, it was in perfect full sentences.', 'score': 1220, 'replies': []}]}]}]}]}, {'author': 'DeathSpiral321', 'author_pfp': 'https://styles.redditmedia.com/t5_23mu8x/styles/profileIcon_snoo3cc7cdd3-b086-4fdd-83b5-fb7356143e71-headshot.png?width=256&height=256&crop=256:256,smart&s=9a4421fe1df5f276022e9ce1696a8ec1fe6bd020', 'body': 'Birds having a built in GPS system. They can fly south for the winter, then fly back to the exact same tree up north.', 'score': 22592, 'replies': [{'author': 'Chrossowen', 'author_pfp': 'https://styles.redditmedia.com/t5_17z5pg/styles/profileIcon_snoo3cbd401a-cc8f-46e6-afe8-f2c84236d70f-headshot-f.png?width=256&height=256&crop=256:256,smart&s=13ea5b7de4435f194bc86e21b806847e469187c3', 'body': 'I once saw in a video that they may just know how to feel the magnetic field of the earth, so my guess is that when Winter comes, they just follow a path the South, and can exactly retrace their flight back to North once it warms up again.', 'score': 6328, 'replies': [{'author': 'nativetrash', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_0.png', 'body': "[Researchers discovered that the light-sensitive protein cryptochrome 4, found in birds' retinas, is sensitive to magnetic fields and could well be the long-sought magnetic sensor of the migratory birds.](https://www.nature.com/articles/s41586-021-03618-9)", 'score': 5099, 'replies': [{'author': 'raphosaurus', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_3.png', 'body': 'So birds can "see" magnetic fields? Rad!', 'score': 2290, 'replies': [{'author': 'keeperkairos', 'author_pfp': 'https://styles.redditmedia.com/t5_az17v/styles/profileIcon_mefy716hza561.PNG?width=256&height=256&crop=256:256,smart&s=1ea6b47fed3c434bff3d38c16a29ca8b9807a2e3', 'body': 'Just because it’s in their retina doesn’t mean they ‘see‘ them, but they might. The brain can evolve to process the information it get however it likes.', 'score': 1857, 'replies': []}]}]}]}]}, {'author': 'Wishyouamerry', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_3.png', 'body': 'The internet. How it works,  and also just the whole concept of it. Complete strangers on literally the other side of the planet can interact with me almost instantaneously.', 'score': 12873, 'replies': [{'author': 'oilpaint8', 'author_pfp': 'https://styles.redditmedia.com/t5_1ix0me/styles/profileIcon_snoo81191ad9-593c-471b-8259-46965bd71b75-headshot.png?width=256&height=256&crop=256:256,smart&s=cfeac585997c7a7bcae018fb5755f12f5f9e33ca', 'body': 'Like this. “Hi there.”', 'score': 5343, 'replies': [{'author': 'ryanegauthier', 'author_pfp': 'https://styles.redditmedia.com/t5_1k6xj3/styles/profileIcon_snoo986b137a-ea40-4582-a820-c4f002ba99be-headshot-f.png?width=256&height=256&crop=256:256,smart&s=b34922dfe1d448e54ec9fb2844cbe89e4e6946fe', 'body': 'Hello world.', 'score': 3313, 'replies': [{'author': 'brendalix13xox', 'author_pfp': 'https://styles.redditmedia.com/t5_2eiggx/styles/profileIcon_p01l7ub5dn681.jpg?width=256&height=256&crop=256:256,smart&s=184e91a8904b1c7ea04fffe18d1e069f84015645', 'body': 'Hello everybody!', 'score': 1385, 'replies': [{'author': 'Fixes_Computers', 'author_pfp': 'https://styles.redditmedia.com/t5_c2pd4/styles/profileIcon_snoo139d6672-77a9-4aa3-9d6f-1c3755e6df2c-headshot-f.png?width=256&height=256&crop=256:256,smart&s=9414efd32ea01c2f37795dc4db299b881d702752', 'body': 'Hi Dr. Nick!', 'score': 1209, 'replies': []}]}]}]}]}, {'author': '-Buck65', 'author_pfp': 'https://styles.redditmedia.com/t5_upy1x/styles/profileIcon_snoo49c8179a-2c48-41f7-a28a-bb92424b5973-headshot.png?width=256&height=256&crop=256:256,smart&s=6aa54e5f0acdaef1785cc73f6b8aa4cb74d11733', 'body': 'Using sharp metal to scrape hair off of my face.', 'score': 11735, 'replies': [{'author': 'pass_me_the_salt', 'author_pfp': 'https://styles.redditmedia.com/t5_4t6cba/styles/profileIcon_snoo66868f02-ab3d-4bef-836e-3e2c17cbe5a9-headshot.png?width=256&height=256&crop=256:256,smart&s=b51335034f5605ba32cf1235c5f14f7ff1adef6e', 'body': "I think in genitalia is even weirder, it's so sensitive", 'score': 5665, 'replies': [{'author': 'Modifiedfinal', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_1.png', 'body': "I personally don't use my genitalia to scrape hair off my face, but to each their own I guess.", 'score': 12140, 'replies': [{'author': 'MyThickPenisIsSoLong', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_6.png', 'body': 'Then whose genitalia do you use to scrape hair off my face?', 'score': 3628, 'replies': [{'author': 'inacoma7', 'author_pfp': 'https://styles.redditmedia.com/t5_1ny7su/styles/profileIcon_snoo6715569f-84e6-4762-96fe-00117cdeeef2-headshot.png?width=256&height=256&crop=256:256,smart&s=8da9ceedb42274622e998d412dfffce2c806aa0e', 'body': 'Gillettealia', 'score': 223, 'replies': []}]}]}]}]}, {'author': 'Aceandmace', 'author_pfp': 'https://styles.redditmedia.com/t5_2o40fg/styles/profileIcon_snoocb62d02b-a10c-4822-a0d9-01adef8f8528-headshot-f.png?width=256&height=256&crop=256:256,smart&s=5bd5d5022a91b87624379d1b7a4160944fd15dae', 'body': 'Kissing. \nI mean, I like it. It\'s nice.  But honestly, who was the first person to say "let\'s mash my mouth against your mouth and see what happens"?', 'score': 5756, 'replies': [{'author': 'jim45804', 'author_pfp': 'https://styles.redditmedia.com/t5_apu9k/styles/profileIcon_snoob64b506b-9e7c-49b4-8a05-6e1094927a97-headshot.png?width=256&height=256&crop=256:256,smart&s=31dced149deb5d8e954adff1177779138d7b2a87', 'body': 'Lips are erogenous zones.', 'score': 2021, 'replies': [{'author': 'Phormitago', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_4.png', 'body': "Now, granted, but why does french kissing feel so good but if you think about it it's fucking gross?", 'score': 1207, 'replies': [{'author': 'tigersharkwushen_', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_5.png', 'body': 'Whether something is gross is completely subjective.', 'score': 851, 'replies': [{'author': 'FrosttheVII', 'author_pfp': 'https://styles.redditmedia.com/t5_1tiyie/styles/profileIcon_pj8gki4uc7071.jpg?width=256&height=256&crop=256:256,smart&s=ac6ded646cf558d1c9898b632a2835876d8d478e', 'body': 'Especially in intimacy/sex mode', 'score': 619, 'replies': []}]}]}]}]}, {'author': 'Wishyouamerry', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_3.png', 'body': 'Reading. Like, there are these random squiggles and we can instantly interpret them into complex thoughts, concepts, feelings, emotions - from people we’ve never met or sometimes even heard of before. It’s weird.', 'score': 21029, 'replies': [{'author': 'Snoo98402', 'author_pfp': 'https://styles.redditmedia.com/t5_2twx6m/styles/profileIcon_snoo43127e6b-9ba9-4c32-8597-bc1b0c71eeb1-headshot-f.png?width=256&height=256&crop=256:256,smart&s=a166363cf21a10396bdadb0acbe300a91446e7c8', 'body': 'I sometimes think about how crazy construction of a language to tell a story must have been back in the day and how powerful a tool language is.', 'score': 5390, 'replies': [{'author': 'Kungvald', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_5.png', 'body': 'Indeed. Language is one of the most important reasons for why humanity is what it is, as it has allowed for information and knowledge to be saved, passed on, and improved upon throughout generations.', 'score': 2415, 'replies': [{'author': 'Roasted_Turk', 'author_pfp': 'https://styles.redditmedia.com/t5_1ixak8/styles/profileIcon_snoo4e6ce2e6-a7b9-4199-bae7-dd18ccfeac2f-headshot-f.png?width=256&height=256&crop=256:256,smart&s=34e8d0c936bebf1add7f9b406ccc5ccb043bbe06', 'body': 'On top of written language I was tripping myself out the other day thinking about how fine tuned our ears are to hear all sorts of voices and tones and be able to decipher spoken words instantly.', 'score': 164, 'replies': [{'author': 'Schnoofles', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_7.png', 'body': 'You may appreciate [this](https://www.youtube.com/watch?v=FjHJ7FmV0M4) speech from Richard Feynman about light and our eyes, then. Similar concept, regarding the near magical ability we have to pick out a section of the electromagnetic spectrum, detect an immensely complicated ocean of waves travelling in all directions from countless sources and immediately make sense of it and note with incredible detail a specific part of our choosing.', 'score': 107, 'replies': []}]}]}]}]}, {'author': 'ldm_12', 'author_pfp': 'https://styles.redditmedia.com/t5_1rngcy/styles/profileIcon_snoo3dbe213a-22c8-42f0-ad29-5a1f7f1c2687-headshot.png?width=256&height=256&crop=256:256,smart&s=c9d9e8103c1db19b6f332fa22fa9915020bdfc8b', 'body': 'Crying, why does my body create liquid from my eyes if something is sad\n\nEdit: holy shit this comment has blown up, I’ve only ever had like 50 upvotes at most for anything hahaha Merry Christmas !', 'score': 22704, 'replies': [{'author': 'Glum-Commission-6506', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_5.png', 'body': 'The chemical everyone is talking about is cortisol, the stress hormone and crying actually lowers your cortisol levels. That’s why you feel better after crying.', 'score': 12744, 'replies': [{'author': 'BipolarLollipopxo', 'author_pfp': 'https://styles.redditmedia.com/t5_528ed5/styles/profileIcon_snooa21bb501-4b07-4a44-86f9-3200dfa60cc6-headshot.png?width=256&height=256&crop=256:256,smart&s=1a03138c101f305b1c14cbfa43cfbc10b86e10f5', 'body': 'You’re supposed to feel better after crying? Bro I get a headache and need a nap', 'score': 9278, 'replies': [{'author': 'PrincessOfZenithia', 'author_pfp': 'https://styles.redditmedia.com/t5_3od8dp/styles/profileIcon_snoo92263f12-ae00-48cf-8316-cea6c0b54bce-headshot.png?width=256&height=256&crop=256:256,smart&s=9af4337cf3d51823cdd48c10c8f9c8b84600518a', 'body': 'Your brain misses its usual high level of cortisol lol', 'score': 3748, 'replies': [{'author': 'GaseousGiant', 'author_pfp': 'https://styles.redditmedia.com/t5_180dr6/styles/profileIcon_snoo801503be-e4d5-4871-819b-ee97c2dff48b-headshot-f.png?width=256&height=256&crop=256:256,smart&s=d93f537707e64206360dc5f0e1d5645a497ec7ab', 'body': 'This is actually true; cortisol negates pain, and stress relief is a real trigger for migraine headache in many people.\n\nEdit: People have been asking for a source.  I’m no expert on this, but there is lots of anecdotal and some clinical evidence for the phenomenon of “let-down” migraine.  \nGeneral article: \n\nhttps://www.migraineagain.com/migraine-work-7-tips-end-letdown-headache/\n\nI think it’s mostly based on this 2014 study: \n\nhttps://www.ncbi.nlm.nih.gov/pmc/articles/PMC4001194/\n\nIt’s probably a sign of chronic stress.', 'score': 2496, 'replies': []}]}]}]}]}, {'author': 'yuxngdogmom', 'author_pfp': 'https://styles.redditmedia.com/t5_29t1oa/styles/profileIcon_snooe1b2523c-d9f4-4114-88f5-1319de14d376-headshot.png?width=256&height=256&crop=256:256,smart&s=7fb50530e530b04461b77ca71c2519e65f9bb7be', 'body': 'Having pets. I have two dogs that I love to death but when I really think about it, I realize they’re just two random animals that I saw one day and said “yeah I like that one” and put them in my home against their will and I give them food regularly and smother them with more affection than I give to other people. And those two random animals seem to think that’s totally dope and show signs of liking me back.', 'score': 19767, 'replies': [{'author': 'CheeseToasties_', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_3.png', 'body': 'I agree, the fact we have another living creature with us and bond with it. I understand how we got to this point but it still amazes me.', 'score': 912, 'replies': [{'author': 'cleancalf', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_3.png', 'body': 'It’s wild how perceptive they are too, and the instincts they carry. \n\nMy dog is 5 now, a border collie so she’s got tons of energy, and still acts like a puppy. When my son was born 2.5 years ago, I was afraid I would have to give her to my dad or sister because she was so crazy but she’s actually really good with my son. \n\nShe’s super protective of him, but also loves to play with him, and has always been very gentle with him. Sometimes too gentle, my son will yank on her ears, or sit on her back if I’m not paying attention but she just lets him do it.', 'score': 35, 'replies': []}, {'author': 'P0sitive_Outlook', 'author_pfp': 'https://styles.redditmedia.com/t5_1h7qpa/styles/profileIcon_snoo0ae8ea4c-a50c-457b-bc55-a4dcd9c1113f-headshot.png?width=256&height=256&crop=256:256,smart&s=87df33602c032b25ac8c73b6cda3bf0fc7aa73e8', 'body': "There's a crow which bonded with me somewhat at work. I mean, i feed it so i get that it's getting a lot out of this deal, but over the course of 24 months not once has it had a go at me or been a dick like a lot of the seagulls i see around here.", 'score': 24, 'replies': []}]}, {'author': 'Willow__________', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_2.png', 'body': 'Oh yeah, I always get stuck on this, esp if I\'m stoned. I just stare at the cat and dog and am like, "What do you think is going on here? What do you think I\'m saying? Do you wonder where your kin are? What do you think I am...friend, pseudo-mother, some random beast?!" It\'s so wild we learn to communicate effectively with them and have mutually beneficial relationships with them. I\'ve never gotten over it.', 'score': 7544, 'replies': []}]}, {'author': 'lukeyt890', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_0.png', 'body': 'The fact we piss, shit and receive pleasure within a two inch radius\n\nTo all the smart arses that say it doesn’t apply to them because they’re hung, your cum gland still starts in your bollocks', 'score': 6882, 'replies': [{'author': 'anticultured', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_7.png', 'body': 'Shit, piss, orgasm, and offspring new life.', 'score': 2893, 'replies': [{'author': 'ChaoticxSerenity', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_3.png', 'body': 'If you were a lizard, you could do all 4 things with one hole. Such efficiency!', 'score': 2129, 'replies': [{'author': 'Sir-Simon-Spamalot', 'author_pfp': 'https://styles.redditmedia.com/t5_sutrs/styles/profileIcon_snoo1b76f469-ff60-4d9f-bee3-c6946faeafea-headshot-f.png?width=256&height=256&crop=256:256,smart&s=84f94689e0e77861990e9ecbb574ed63f4a7aab0', 'body': "You're a lizard, Harry!", 'score': 124, 'replies': []}]}]}, {'author': 'ocodo', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_3.png', 'body': "obviously it's natures way to promote personal hygiene. \n\nWanna get some? Clean your ass!", 'score': 38, 'replies': []}]}, {'author': 'nedimiedin', 'author_pfp': 'https://styles.redditmedia.com/t5_98gr1/styles/profileIcon_d3t8ylvw01e71.jpg?width=256&height=256&crop=256:256,smart&s=f62f6adc657bdb2e7c6195e38b2056d5dcc8fcbd', 'body': 'Probably half of the words in any given language. Repeat any word a handful of times, and it can start to sound really weird. Then I start questioning why that word is associated with whatever it’s associated with. There’s usually never a good answer, but it’s great enunciation practice for sure!i\n\nEdit: thank you fellas and lady fellas for my most-upvoted comment on here so far! Merry Christmas and happy holidays to everyone:)', 'score': 2992, 'replies': [{'author': 'granolabar1127', 'author_pfp': 'https://styles.redditmedia.com/t5_vxjbf/styles/profileIcon_snoo5c0f68aa-3096-4d26-a241-d77f79fd163b-headshot.png?width=256&height=256&crop=256:256,smart&s=06683d0340bf0b36947291ec855f3d4ddb470d19', 'body': 'I think the phenomenon is called Semantic Satiation (when you say a word repeatedly and it sounds like nonsense after a while)', 'score': 827, 'replies': [{'author': 'fantompwer', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_4.png', 'body': 'Thanks coach', 'score': 48, 'replies': []}]}]}, {'author': 'workinghr', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_3.png', 'body': 'Being alive, in this world…', 'score': 6136, 'replies': [{'author': 'PermabannedX4', 'author_pfp': 'https://styles.redditmedia.com/t5_5emw8z/styles/profileIcon_snoo5560cd7c-8f5e-49ba-a009-571427870243-headshot.png?width=256&height=256&crop=256:256,smart&s=2ba93d814cda26bd2973db3dd14fe9bb7739b609', 'body': 'Just the fact that everything.....exists. \n\nOr does it?', 'score': 3256, 'replies': [{'author': 'PuFF1512', 'author_pfp': 'https://styles.redditmedia.com/t5_bti7d/styles/profileIcon_snoo137b2bbd-66ee-4ecb-b84e-c5f4e3363aeb-headshot.png?width=256&height=256&crop=256:256,smart&s=97f7ed84bcdab93998d239ebe9b599a9d6e9e44d', 'body': 'I love to get stoned and just stare at shit thinking  " how tf is this even real". It mostly leads to panic attacks but seriously... wtf is everything?', 'score': 1821, 'replies': [{'author': 'GodMonster', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_1.png', 'body': 'I did mushrooms once and just laid in bed appreciating friction for like two hours.', 'score': 810, 'replies': [{'author': 'amir_teddy360', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_7.png', 'body': '“appreciating friction”\nIs that a reference to something…', 'score': 232, 'replies': []}]}]}]}]}, {'author': 'PermabannedX4', 'author_pfp': 'https://styles.redditmedia.com/t5_5emw8z/styles/profileIcon_snoo5560cd7c-8f5e-49ba-a009-571427870243-headshot.png?width=256&height=256&crop=256:256,smart&s=2ba93d814cda26bd2973db3dd14fe9bb7739b609', 'body': "The fact that almost everybody finds somebody's *butt* attractive.", 'score': 10259, 'replies': [{'author': 'SymphonyForTheDevil', 'author_pfp': 'https://styles.redditmedia.com/t5_28st9u/styles/profileIcon_snooc643c948-ccfc-4722-b876-b2b9377d3ac8-headshot-f.png?width=256&height=256&crop=256:256,smart&s=07322bc6d475fbc38aa1ad49258c94927c0ed317', 'body': "Daaaamn, look at the bulge of muscle and fat at the top of that person's legs! I find its curvature makes me want to mate.", 'score': 7038, 'replies': [{'author': 'thief90k', 'author_pfp': 'https://styles.redditmedia.com/t5_1xd8vt/styles/profileIcon_snoo302b0dfc-9c22-4c95-8dc6-1e002d885142-headshot-f.png?width=256&height=256&crop=256:256,smart&s=8a0ac7c758274ae15b8688c526174418d87a73de', 'body': 'Buddy, have you seen the bulbous fatty orbs surrounding the mammary glands?', 'score': 3216, 'replies': [{'author': 'OccultOpossom', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_6.png', 'body': "I've pondered that orb", 'score': 1479, 'replies': [{'author': 'Andibular', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_2.png', 'body': 'Feels like a bag of sand', 'score': 23, 'replies': []}]}]}]}]}, {'author': 'TheOther_OtherGuy', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_5.png', 'body': 'Ballons. Like here, have a sack of breath..', 'score': 850, 'replies': [{'author': 'Joe5691', 'author_pfp': 'https://styles.redditmedia.com/t5_2ay73t/styles/profileIcon_snoo12ae02dd-b6b6-414b-ac64-a8611491db92-headshot.png?width=256&height=256&crop=256:256,smart&s=752557d58839c02fc44ec816eac65d7a83fa22f4', 'body': 'But hear me out. Sack of floaty air. Now thats cool.', 'score': 85, 'replies': []}]}, {'author': 'DaniJHollis', 'author_pfp': 'https://styles.redditmedia.com/t5_35tyni/styles/profileIcon_mz1hi67csvv51.jpg?width=256&height=256&crop=256:256,smart&s=2aed276cd45b12779947873a7911ad5473e36939', 'body': "Teeth. \n\nI don't know why. Your teeth are the only part of your skeleton that you can see. You bleach 'em, you lose em, you put metal racks on them so you remold your bones to the shape that society finds visually appealling. There's a fictional woman that breaks into your house to pay you for these bones. It sounds like a straight up sociopath. We get film on them that calcifies & solidifies & makes other bone-like material. Like teeth are weird, dude.", 'score': 2382, 'replies': [{'author': 'ArcticSix', 'author_pfp': 'https://styles.redditmedia.com/t5_b2z09/styles/profileIcon_snoob490caf9-92c8-47c7-835d-cc6185e1317f-headshot.png?width=256&height=256&crop=256:256,smart&s=b1e533df70197f07696a18af636bc63d85205270', 'body': "*It's even worse:  your teeth aren't part of your skeleton. Your skeleton forms from the mesoderm during gastrulation. Your nervous system, mucous membranes, teeth, and skin form from the ectoderm.  Your teeth are more like hard, pointy skin than bones.\n\nYour mouth is full of skin rocks.\n\nEdit:  A Word", 'score': 1660, 'replies': [{'author': 'AwesomeCream810', 'author_pfp': 'https://styles.redditmedia.com/t5_3lshlh/styles/profileIcon_snoo80ac796e-b554-482c-b712-fc744a9071b3-headshot-f.png?width=256&height=256&crop=256:256,smart&s=6e6869b19b73248e2fd178503e6226834b4417da', 'body': '“Your mouth is full of skin rocks” will now forever live rent free in my head. Thank you kind stranger', 'score': 660, 'replies': [{'author': 'Geminii27', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_1.png', 'body': 'You can think about it at the same time as thinking about having a roiling mouth of too many loose teeth. Just... schlorp-rattling around in there as you chew on them. Crunchy!', 'score': 23, 'replies': []}]}]}]}, {'author': 'redditoruser3021', 'author_pfp': 'https://styles.redditmedia.com/t5_5953rg/styles/profileIcon_snood4d3f199-1e62-428c-9907-cb6233fdf4bf-headshot.png?width=256&height=256&crop=256:256,smart&s=11881154eb2945f7a136f568be3bebb48ad0107f', 'body': 'Dreaming.  Whole worlds, people following some kinda plot. Coming to same places in different dreams, sometimes years away. Then we wake up and puff! Off it goes', 'score': 541, 'replies': [{'author': 'executorcj', 'author_pfp': 'https://styles.redditmedia.com/t5_b2hqb/styles/profileIcon_snoo06dc9084-c509-4293-b0f8-57bfaa0a940d-headshot-f.png?width=256&height=256&crop=256:256,smart&s=c4f57cb28eb470933badaa31dfdc2ca58aab6c5f', 'body': 'I feel like I have huge epics in my head but I can remember just the most vague details. Entire lifetimes gone it feels like', 'score': 30, 'replies': []}]}, {'author': 'wolf55HGFfa', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_2.png', 'body': 'My tongue is a meat tentacle', 'score': 18167, 'replies': [{'author': 'Theresneverenoughpud', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_4.png', 'body': 'Arent all tentacles meat?', 'score': 2709, 'replies': [{'author': 'wickedblight', 'author_pfp': 'https://styles.redditmedia.com/t5_eqp5g/styles/profileIcon_snooee929242-84eb-4d7c-af82-604d022b401b-headshot-f.png?width=256&height=256&crop=256:256,smart&s=082213c6a5fc7cc93fa554e4a01045f7994ec087', 'body': 'There are sillicone/rubber ones you can buy for... reasons these days', 'score': 2517, 'replies': [{'author': 'salamander_jesus609', 'author_pfp': 'https://styles.redditmedia.com/t5_1p6a8h/styles/profileIcon_snood46add10-dcb9-4536-9893-75fbf4ab6865-headshot.png?width=256&height=256&crop=256:256,smart&s=06dcf77cc1c059190f403c68dda5b6fb7a17e7f6', 'body': 'Grow a spine, and just say they are for shoving up your butt!!!', 'score': 1242, 'replies': [{'author': 'wickedblight', 'author_pfp': 'https://styles.redditmedia.com/t5_eqp5g/styles/profileIcon_snooee929242-84eb-4d7c-af82-604d022b401b-headshot-f.png?width=256&height=256&crop=256:256,smart&s=082213c6a5fc7cc93fa554e4a01045f7994ec087', 'body': 'Ohhh, yes butt stuff. Definitely not making an octopus mech to conquer the seas, that would be crazy.', 'score': 1285, 'replies': []}]}]}]}]}, {'author': 'tenthinsight', 'author_pfp': 'https://styles.redditmedia.com/t5_co817/styles/profileIcon_snoo7938ac12-6e35-4a73-b68e-8fea5b719da3-headshot.png?width=256&height=256&crop=256:256,smart&s=ce01b40725ca5d6b9a554995aea55038d3c89245', 'body': 'Public bathroom stalls in the US. Completely normal yet 100% fucked.', 'score': 2126, 'replies': [{'author': 'GrayAreaHeritage', 'author_pfp': 'https://styles.redditmedia.com/t5_546wkc/styles/profileIcon_snoo1a1ef29f-c086-4b80-83f1-d2db50a905fd-headshot.png?width=256&height=256&crop=256:256,smart&s=f5a7fe4e587c5649f5c959a9853b95dde2b52930', 'body': "The gap...like why? I don't need to look a stranger in the eyes as I pass a food baby.", 'score': 1381, 'replies': [{'author': 'MiaLba', 'author_pfp': 'https://styles.redditmedia.com/t5_4dor46/styles/profileIcon_snoofaecba4c-a85f-4927-9e6d-76475ac9f981-headshot-f.png?width=256&height=256&crop=256:256,smart&s=ef92dfb24ddd0ea84bddfcd488e2ed7af08e23cf', 'body': 'I had someone’s toddler crawl under the door into my stall one time. Got all the way under and then stood up and stared at me while I was on the toilet. I yelled out “someone’s child is in my stall!” I had to open my door while I was still shitting to get him out to his mom. Like what the fuck. One of the weirdest things to ever happen to me.', 'score': 1089, 'replies': [{'author': 'GrayAreaHeritage', 'author_pfp': 'https://styles.redditmedia.com/t5_546wkc/styles/profileIcon_snoo1a1ef29f-c086-4b80-83f1-d2db50a905fd-headshot.png?width=256&height=256&crop=256:256,smart&s=f5a7fe4e587c5649f5c959a9853b95dde2b52930', 'body': "That's really weird. And I'd have a germ meltdown if my kid was crawling on the floor of a public bathroom. Ew ew ew.", 'score': 586, 'replies': [{'author': 'lonewulf66', 'author_pfp': 'https://styles.redditmedia.com/t5_1qlfmb/styles/profileIcon_snoo50083012-bb60-4d28-ab01-34592e58b940-headshot-f.png?width=256&height=256&crop=256:256,smart&s=cf83b0d2ecfa93deb9d7013cd352f61add8b8b6f', 'body': "Some parents really just let their kids go. I've walked into public restrooms that young children were treating like a playground. It's filthy and the parents should be ashamed.", 'score': 330, 'replies': []}]}]}]}]}, {'author': 'MotherAgnes', 'author_pfp': 'https://styles.redditmedia.com/t5_5h25hl/styles/profileIcon_snood622022e-fdbc-4e47-84d7-81f775e3e95a-headshot.png?width=256&height=256&crop=256:256,smart&s=b9696cd0b90727b841b7d531bd812488858dd5f5', 'body': 'Paparazzi: they do everything just like a stalker, yet they’re not incarcerated for it and paid to do the things they do.', 'score': 14369, 'replies': [{'author': 'Jazzlike_Log_709', 'author_pfp': 'https://styles.redditmedia.com/t5_54yrdp/styles/profileIcon_snoo0aef1d2d-c517-4a65-83c8-b07f6c816cef-headshot.png?width=256&height=256&crop=256:256,smart&s=9932c864ee0ea81daf73a7906c89621440d235b3', 'body': "It makes me cringe whenever I see tabloid and paparazzi photos, especially where the subject of the photo is visibly uncomfortable. It's so intrusive. Even worse when children are stalked by them. Why is it legal?", 'score': 5250, 'replies': [{'author': 'MotherAgnes', 'author_pfp': 'https://styles.redditmedia.com/t5_5h25hl/styles/profileIcon_snood622022e-fdbc-4e47-84d7-81f775e3e95a-headshot.png?width=256&height=256&crop=256:256,smart&s=b9696cd0b90727b841b7d531bd812488858dd5f5', 'body': 'Stalking is horrible, but doing it to children is even worse and is a form of abuse… have you seen some of the lengths the paparazzi goes in order to get that one photo shot or interview?', 'score': 2026, 'replies': [{'author': 'comfortablynumb15', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_6.png', 'body': 'there are a few humans I find unredeemable, that no amount of jail time is good enough for or who just ignore penalties against them. Paparazzi are in that category. The actually lay on the ground when Emma Watson was going to her 18th Birthday party so they could get upskirt photos without breaching kiddy porn laws. (and who is to say all the "unusable" photos of minors are deleted when there are people out there who would pay big bucks for a panty shot of a celebritie\'s child ? )', 'score': 1294, 'replies': [{'author': 'ashamedGelding5', 'author_pfp': 'https://styles.redditmedia.com/t5_4k3ipr/styles/profileIcon_snoof95cbe17-5538-4927-a672-378be8d928d0-headshot.png?width=256&height=256&crop=256:256,smart&s=88aa7bccc2b04e709ea8c39b65a034e63173276c', 'body': 'That is disgusting and messed up, I have no idea why people chose to make a living like a leech', 'score': 480, 'replies': []}]}]}]}]}, {'author': 'Infamous_Throat2603', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_2.png', 'body': "Allergies. Like how the fuck does your body become deathly allergic to something that isn't capable of killing another person. Please someone explain that shit.", 'score': 236, 'replies': [{'author': 'Opening_Yellow_8631', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_2.png', 'body': 'I’m not a doctor so if there are any doctors or people who know more about this please correct me and share more information. \n\nIn short, it is a overreaction of the immune system. Our immune system is necessary to keep us alive by ridding the body of any pathogens, but because the body is very intricate and prone to errors it is a common mistake harmless materials as some sort of pathogen. \n\nAllergic reactions occur when your immune system recognizes a substance that it believes to be harmful and attacks it. The body then releases chemicals called histamines, who’s purpose is to rid the body of the allergen as quick as possible, and will cause coughing, itching, or tearing up; whatever will help rid the body of the allergen.\n\nThe reason the body attacks a specific substance is that when the body recognizes an allergen it makes a specific antibody called IgE. This antibody is specifically made for the substance that your body reacted to and so it is released almost every subsequent time the body is exposed to the same allergen. When the body detects the substance again, releases the antibody and then triggers the reaction again.', 'score': 29, 'replies': []}]}, {'author': 'HarmonXifa', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_2.png', 'body': "Clapping, animals must think we're mental. Apart from seals, seals know", 'score': 25020, 'replies': [{'author': 'ctadgo', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_5.png', 'body': 'What’s weird is I think it’s something innate. Babies clap all the time when they’re happy. Sometimes when I get really excited I instinctively clap. So like where did that trait come from? I wonder if other primates do it. Maybe it’s like dogs wagging their tail.', 'score': 4735, 'replies': [{'author': 'furiousfran', 'author_pfp': 'https://styles.redditmedia.com/t5_cguj5/styles/profileIcon_snoo787c4173-f83f-481c-a848-7dd3d7113a4e-headshot.png?width=256&height=256&crop=256:256,smart&s=aca5176e3a61d042e2c890ac3bb90dce91733736', 'body': "They do, in fact! They've even found that chimps will clap and sway when music is played for them.", 'score': 3289, 'replies': [{'author': 'WalGuy44', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_7.png', 'body': 'What are chimpanzees favorite artist?', 'score': 1279, 'replies': [{'author': 'UnresolvedDrama', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_5.png', 'body': 'Gorillaz', 'score': 3925, 'replies': []}]}]}]}]}, {'author': 'tightpussyfatnuts', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_5.png', 'body': 'The fact that a majority of people think in images. Like, think of an apple and see, in the mind, a picture of an apple. So weird to me, I’ve never “seen” anything up there.', 'score': 2426, 'replies': [{'author': 'eeyore_or_eeynot', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_5.png', 'body': "Real head scratcher for me (pretty sure I have aphantasia or whatever it is called)....is I can recognize things/people just fine....and even have visual dreams so I know the capability is there. But when I try to close my eyes and visualize something, be it the room I'm currently in, the house I grew up in, FFS even my Mothers face.....all I get is darkness", 'score': 441, 'replies': [{'author': 'or2072', 'author_pfp': 'https://styles.redditmedia.com/t5_27qh42/styles/profileIcon_snoo55bafd47-c194-44a3-8831-1cc87467b261-headshot.png?width=256&height=256&crop=256:256,smart&s=bd37a8a2c93d10c66bd18e56572f71df4191e581', 'body': "It's not exactly seeing it, it's imagining it", 'score': 82, 'replies': []}]}, {'author': 'Teck_3', 'author_pfp': 'https://styles.redditmedia.com/t5_ag814/styles/profileIcon_91npx6rwfrh21.jpg?width=256&height=256&crop=256:256,smart&s=3fa1cd997c8576fb32dc783e43896ee5d2c3b7d8', 'body': "Wait, what? Like, people think in images instead of an inner monolog? I don't see mental images unless I'm intentionally trying to create one.\n\nMaybe I'm just misinterpreting this...", 'score': 651, 'replies': [{'author': 'mariii95', 'author_pfp': 'https://styles.redditmedia.com/t5_gf62j/styles/profileIcon_snooa487db69-dea3-4afd-95f3-61bf3379f85e-headshot.png?width=256&height=256&crop=256:256,smart&s=6f1c855d5492e66a9f734bf429770a1faaf91c5f', 'body': 'I think in both, I have inner monologue and very vivid images.', 'score': 457, 'replies': []}]}]}, {'author': 'Canadian_Human_123', 'author_pfp': 'https://styles.redditmedia.com/t5_5cqtic/styles/profileIcon_ok323otkgk781.jpg?width=256&height=256&crop=256:256,smart&s=ba83bbd5cb24cfd32805eb6c77b3402099244b47', 'body': 'Scrolling on Reddit. Like wtf you just rubbing the phone screen.', 'score': 6333, 'replies': [{'author': 'DeathSpiral321', 'author_pfp': 'https://styles.redditmedia.com/t5_23mu8x/styles/profileIcon_snoo3cc7cdd3-b086-4fdd-83b5-fb7356143e71-headshot.png?width=256&height=256&crop=256:256,smart&s=9a4421fe1df5f276022e9ce1696a8ec1fe6bd020', 'body': 'Phones must get so aroused, with getting massaged all the time and everything.', 'score': 1997, 'replies': [{'author': 'Flame66624', 'author_pfp': 'https://styles.redditmedia.com/t5_4j73w9/styles/profileIcon_snooffda42cb-0cc9-4cf1-ac37-ba7c6b81b404-headshot.png?width=256&height=256&crop=256:256,smart&s=e78617f3da40fd393f586c05b18c8bd0275cdabb', 'body': "Don't make it weirder", 'score': 1246, 'replies': [{'author': 'jimjamjimmerson', 'author_pfp': 'https://styles.redditmedia.com/t5_29vxed/styles/profileIcon_snoo7ff2a8da-58c1-48a8-b638-63d9f525dd33-headshot.png?width=256&height=256&crop=256:256,smart&s=4849b17856d7cde231c7381baecddfc03977ecb2', 'body': 'You like that you little slut?\n\nSorry talking to my phone.', 'score': 869, 'replies': [{'author': 'Myonenonpornacc', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_2.png', 'body': "Oh... 😒 that's fine.", 'score': 96, 'replies': []}]}]}]}]}, {'author': '-eDgAR-', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_4.png', 'body': 'Keeping fish as pets.\n\nWith other pets you can cuddle, pet, and play with them, but fish just sit there in their tanks and some people use them more as like a living  decoration.', 'score': 1453, 'replies': [{'author': 'Uttuuku', 'author_pfp': 'https://styles.redditmedia.com/t5_2dp3uj/styles/profileIcon_snoodd81ed71-8969-4edc-bfba-a627e710fc54-headshot.png?width=256&height=256&crop=256:256,smart&s=c1c5f3bafdea1d643a5abe0c7eded5da74abbdec', 'body': "I just think they're neat! Fish do have quite the personalities and more intelligence than we give them credit for. Some even are intelligent enough to play too! The Goliath grouper is a good example of one. \n\nI used to have more fish with live plants and the whole shebang, but the maintenance wasn't helping my crappy spine, so now I have just my betta. Contrary to popular belief, bettas need a minimum tank size of 5 gallons, a heater, and some clutter in their tank to thrive. Their pretty and I've noticed that my boy only does his wiggle dance when it's me. He just stares with murderous intent at my coworkers lol. If I put on my hat, he'll flare up and when I take off my hat, he'll calm down. It's cute.", 'score': 667, 'replies': [{'author': '-eDgAR-', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_4.png', 'body': ">Contrary to popular belief, bettas need a minimum tank size of 5 gallons, a heater, and some clutter in their tank to thrive. \n\nSo crazy you make this particular point, I've been subscribed to /r/shittyaquariums for a while after I fell into a rabbit hole there and [this](https://www.reddit.com/r/shittyaquariums/comments/rn7827/please_dont_give_live_animals_as_gifts_ever) was on my front page today.", 'score': 215, 'replies': [{'author': 'Uttuuku', 'author_pfp': 'https://styles.redditmedia.com/t5_2dp3uj/styles/profileIcon_snoodd81ed71-8969-4edc-bfba-a627e710fc54-headshot.png?width=256&height=256&crop=256:256,smart&s=c1c5f3bafdea1d643a5abe0c7eded5da74abbdec', 'body': "I felt a part of my soul die for the second time today seeing a shitty aquarium. \n\nI pet sit as a side job and one of my clients has a filthy 1 gallon aquarium with two guppies and 3 neon tetras. I have an empty 10 gallon that I'm tempted to put next to their tank for when they get back.", 'score': 23, 'replies': []}]}]}, {'author': 'ruralmutant', 'author_pfp': 'https://styles.redditmedia.com/t5_c8b6f/styles/profileIcon_snoo7c680933-30a1-4867-bc76-9ded0945f5a1-headshot.png?width=256&height=256&crop=256:256,smart&s=7732adf0a375b1114e71c432796b3a15877fd33a', 'body': "A guy I knew said 'If I can't pet it, it ain't a pet.' He was talking about alligators but I think it applies.", 'score': 449, 'replies': []}]}, {'author': 'Dutch31337', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_0.png', 'body': 'Babies don’t have kneecaps', 'score': 661, 'replies': [{'author': 'Botaratops', 'author_pfp': 'https://styles.redditmedia.com/t5_51ki0r/styles/profileIcon_snoo071732b7-299c-4952-8384-682561f6d673-headshot.png?width=256&height=256&crop=256:256,smart&s=c9cdf4ecc6755fe477f2d5e70e0f81be90106a1f', 'body': 'They also have a hole in their skulls due to their plates not being fixed together yet', 'score': 321, 'replies': [{'author': 'Lasagna_Bear', 'author_pfp': 'https://styles.redditmedia.com/t5_uppe4/styles/profileIcon_snoo1c489b13-a8df-47a2-939f-2484dc31a79a-headshot.png?width=256&height=256&crop=256:256,smart&s=12b696e726e94a07980f4df3d2d4d6496fb93912', 'body': 'Not a whole, just a soft spot of cartilage and tiny bone pieces.', 'score': 65, 'replies': []}, {'author': 'PurplePigeon96', 'author_pfp': 'https://styles.redditmedia.com/t5_4jrzm7/styles/profileIcon_snoodc31524b-faef-408d-af8e-755ec4c9b7e7-headshot-f.png?width=256&height=256&crop=256:256,smart&s=cd150cb58960b656f30acab85362763f37536aa2', 'body': 'If you stare at the babie\'s "soft spot" on their head, there\'s a detectable PULSE. You can visibly see this as their heart beats, the soft spot is actually moving. This creeped me out so much when I had my kids!!!', 'score': 31, 'replies': []}]}, {'author': 'NayaIsTheBestCat', 'author_pfp': 'https://styles.redditmedia.com/t5_xoxtg/styles/profileIcon_snoo251c232d-11d6-42af-ab2a-ec14a001bd0f-headshot.png?width=256&height=256&crop=256:256,smart&s=8141a8a32050d64a012897bbf8f45f168d9ab0b0', 'body': 'TIL', 'score': 26, 'replies': []}]}, {'author': 'realHypeTrains', 'author_pfp': 'https://styles.redditmedia.com/t5_z8aj0/styles/profileIcon_snood05dbf89-a012-4029-acac-0d38ddfcf832-headshot-f.png?width=256&height=256&crop=256:256,smart&s=3334d37142c93956cb3e831652d180fa0e4b4f0d', 'body': '99% of TV and YT ads. Like, they all suck and make me not want to buy the product they advertise. How do commercials make people want to buy things? The only ads that are even useful to me are movie trailers at this point, but almost never for new IP', 'score': 203, 'replies': [{'author': 'juliewebster0321', 'author_pfp': 'https://styles.redditmedia.com/t5_28ps05/styles/profileIcon_snoof0527110-c5c2-4cd4-99ca-0e62f3c8c1e4-headshot.png?width=256&height=256&crop=256:256,smart&s=f2717dc4d09f3f5753ff0d6252aad9b686d89375', 'body': 'and they always have the most obnoxious music like who tf thought we wanted to listen to that?', 'score': 35, 'replies': []}, {'author': 'undercanopy813', 'author_pfp': 'https://www.redditstatic.com/avatars/defaults/v2/avatar_default_4.png', 'body': "Seriously. They tend to have the opposite effect with me - oh, you're going to interrupt the video I'm actively enjoying to try to sell me something? I'm gonna remember you, but not in the way you want.", 'score': 27, 'replies': []}]}, {'author': 'zoeymadison', 'author_pfp': 'https://styles.redditmedia.com/t5_24voo6/styles/profileIcon_snoo84c368a5-3921-4dbc-bdcb-ded4ec59ac3f-headshot.png?width=256&height=256&crop=256:256,smart&s=c077dff1dcabd4e171a8d1b014efe0aa46479344', 'body': 'The fact humans drink other animals milk. Like that liquid isn’t for us. People find the thought of drinking human milk gross but it’s especially formulated for us. It’s something that should he consumed for nutrients when we’re babies, not a regular drink.', 'score': 69, 'replies': []}, {'author': 'MonkeySexTime', 'author_pfp': 'https://styles.redditmedia.com/t5_3xr5qh/styles/profileIcon_snoo1d0c6d24-f631-474d-bc8d-b5423284e429-headshot.png?width=256&height=256&crop=256:256,smart&s=6c579a6dfc918f7ad62f42a78fed0dbd70826377', 'body': 'The fact that all those other people you see out in public all have their own lives that they go home to completely separate from yours.\n\nEdit: ThaNk YoU KiNd sTrANgErS\n\nEdit again: I have been informed many times that the word for this is Sonder.', 'score': 21898, 'replies': [{'author': 'slumbuggy', 'author_pfp': 'https://styles.redditmedia.com/t5_5gcpza/styles/profileIcon_snoo8f0cba4e-c1d7-4a26-8d4c-feb62efee0bb-headshot.png?width=256&height=256&crop=256:256,smart&s=52ca8c9c196c6ef25fcb2c23acd59af88deeb415', 'body': 'I’ve been thinking about this a lot having recently lost my Dad.  Such a big thing to me, but all these people are going about their lives as though it didn’t happen.  Because they too have loss and love and lives that are just as good and hard and rewarding and difficult as my life.  And we all know almost nothing about each other.  Billions of universes mingling together but never interacting in a way which we can perceive…and yet, all of these worlds are connected by countless imperceptible threads.\n\nEdit:  as the post above me says, I also thank all of you, kind friends.  We all carry our joys and our struggles in this beautiful world, so be loving to others and to yourselves and always strive to become love.  In this Christmas season and beyond, know that you matter.', 'score': 9601, 'replies': [{'author': 'Head_Gone', 'author_pfp': 'https://styles.redditmedia.com/t5_8hzh2/styles/profileIcon_snoo54399181-c2ff-475f-af46-4e41a67b0ece-headshot.png?width=256&height=256&crop=256:256,smart&s=2f03a77bfd230a46adbdb51ea9b74248770529fd', 'body': "I totally get this. Lost my dad quite brutally start of this year. Cancer. You can't believe the world doesn't stop for you, for your pain. That everyone isn't as heartbroken as you makes you sort of angry. When people would talk about their day or lives I would get this drop in my stomach because I was in pain, so much of it. Why can't they understand that? Or magically be aware? It's a strange one, and it happens each time you lose someone close to you. Each life is just as intricate, as fragile and expansive as your own.\n\n*Edit. Grammar.", 'score': 3119, 'replies': [{'author': 'BrainSlugsNharmony', 'author_pfp': 'https://styles.redditmedia.com/t5_2jxq6e/styles/profileIcon_ww259TBD0v6xy.png?width=256&height=256&crop=256:256,smart&s=0730fad14da5e605d9ef1e32287a9495e3b39cce', 'body': 'The thought I had when I got the news that my dad had been killed last year: why is everyone walking around like normal while my life is shattering around me? You really do lose your understanding of other people for just a moment.', 'score': 312, 'replies': [{'author': 'Head_Gone', 'author_pfp': 'https://styles.redditmedia.com/t5_8hzh2/styles/profileIcon_snoo54399181-c2ff-475f-af46-4e41a67b0ece-headshot.png?width=256&height=256&crop=256:256,smart&s=2f03a77bfd230a46adbdb51ea9b74248770529fd', 'body': "I think it's strange how in that time we long for a sort of connectedness that doesn't even require speech, we want someone to look as us and see our pain, and maybe even eliviate it somehow while not address it? I think it goes to show that when we're in pain, the comfort of other people is definitely something we humans need. Even if we don't understand it.", 'score': 44, 'replies': []}]}]}]}]}, {'author': 'Rough_Mango8008', 'author_pfp': 'https://styles.redditmedia.com/t5_44uc6j/styles/profileIcon_snooe35a6994-6c64-43c5-b1ca-8047de277440-headshot-f.png?width=256&height=256&crop=256:256,smart&s=34256edbf6959bbbb981e2cf8173d3fdeb2812fc', 'body': 'Writing, I remember when I was a child and first started writing I found it so fascinating how you can transform  your thoughts into something palpable.', 'score': 181, 'replies': []}]
        for cmt in comments:
            path = backend.image.reddit_comment_to_image(cmt)
            if path:
                ret.append(ImageLink(path, is_url=False))
        return ret

    except Exception as ex:
        print(ex)
        return []


def get_simplified_comments(forest, max_comment_roots=35, max_comments_per_tree=5):
    """
    Recursive function that returns a simplified version of a comment.
    :param forest: CommentForest: the forest to simplify.
    :param max_comment_roots: int: The max base comments.
    :param max_comments_per_tree: int: The max comments every tree can have.
                                        Includes branches, not only leaves.
                                        If none, equal to max_comment_roots.
    :return: dict
    """
    if max_comments_per_tree is None:
        max_comments_per_tree = max_comment_roots

    ret = []
    comments = 0
    for comment in forest:
        if comments >= max_comment_roots:
            break

        if not isinstance(comment, praw.reddit.models.MoreComments):
            name = "[deleted]"
            pfp = "https://upload.wikimedia.org/wikipedia/commons/c/c4/600_px_Transparent_flag.png"
            if comment.author:
                name = comment.author.name
                if hasattr(comment.author, "icon_img"):
                    pfp = comment.author.icon_img
            ret.append({
                "author": name,
                "author_pfp": pfp,
                "body": comment.body,
                "score": comment.score,
                "replies": get_simplified_nested_comments(
                    comment.replies,
                    max_comments_per_tree,
                )
            })

        comments += 1

    return ret


def get_simplified_nested_comments(forest, max_comments, current_comments=None, depth=1):
    if current_comments is None:
        current_comments = IntVar(1)

    ret = []
    for comment in forest:
        if current_comments >= max_comments:
            break

        if not isinstance(comment, praw.reddit.models.MoreComments):
            current_comments += 1
            name = "[deleted]"
            pfp = "https://upload.wikimedia.org/wikipedia/commons/c/c4/600_px_Transparent_flag.png"
            if comment.author:
                name = comment.author.name
                if hasattr(comment.author, "icon_img"):
                    pfp = comment.author.icon_img
            ret.append({
                "author": name,
                "author_pfp": pfp,
                "body": comment.body,
                "score": comment.score,
                "replies": get_simplified_nested_comments(
                    comment.replies,
                    max_comments,
                    current_comments=current_comments,
                    depth=depth+1
                )
            })

    return ret


def twitter_user_images(user):
    """
    Fetches a twitter account's top submissions.
    :param user: str: The name of the twitter user.
    :return: ImageLink[]: A list of URLs leading to the images.
    """
    api = twitter.Api(
        consumer_key=Twitter.consumer_key,
        consumer_secret=Twitter.consumer_secret,
        access_token_key=Twitter.access_token_key,
        access_token_secret=Twitter.access_token_secret
    )

    try:
        statuses = api.GetUserTimeline(
            screen_name=user,
            include_rts=False,
            exclude_replies=True,
            count=200
        )
    except twitter.error.TwitterError:
        return []

    ret = []
    for s in statuses:
        if s.media and len(s.media) == 1 and s.media[0].type == "photo":
            photo = s.media[0]
            # original_url = f"https://twitter.com/{user}/status/{s.id_str}"
            ratio = None
            for size in photo.sizes:
                if size != "thumb":
                    ratio = photo.sizes[size]["w"] / photo.sizes[size]["h"]

            if ratio and MIN_RATIO <= ratio <= MAX_RATIO:
                ret.append(ImageLink(photo.media_url_https, True))
    return ret


def sign(key, msg):
    return hmac.new(key, msg.encode("utf-8"), hashlib.sha256).digest()


def get_signature_key(key, date_stamp, region_name, service_name):
    k_date = sign(('AWS4' + key).encode('utf-8'), date_stamp)
    k_region = sign(k_date, region_name)
    k_service = sign(k_region, service_name)
    k_signing = sign(k_service, 'aws4_request')
    return k_signing


def get_tts_audio(text, voice):
    t = datetime.datetime.utcnow()
    amz_date = t.strftime('%Y%m%dT%H%M%SZ')
    date_stamp = t.strftime('%Y%m%d')
    host = "polly.eu-west-1.amazonaws.com"
    region = "eu-west-1"
    service = "polly"
    endpoint = "https://polly.eu-west-1.amazonaws.com/v1/speech"

    method = "POST"
    canonical_uri = "/v1/speech"
    canonical_qstring = ""
    canonical_headers = 'content-type:application/json\n' + 'host:' + host + '\n' + 'x-amz-date:' + amz_date + '\n'
    signed_headers = "content-type;host;x-amz-date"

    body = {
        "OutputFormat": "mp3",
        "TextType": "text",
        "SampleRate": "22050",
        "Text": text,
        "VoiceId": VOICES[voice],
    }
    body = json.dumps(body)

    payload_hash = hashlib.sha256(body.encode('utf-8')).hexdigest()
    canonical_request = method + '\n' + canonical_uri + '\n' + canonical_qstring + '\n' + canonical_headers + '\n'\
        + signed_headers + '\n' + payload_hash

    # Step 2
    algorithm = 'AWS4-HMAC-SHA256'
    credential_scope = date_stamp + '/' + region + '/' + service + '/' + 'aws4_request'
    string_to_sign = algorithm + '\n' + amz_date + '\n' + credential_scope + '\n' + hashlib.sha256(
        canonical_request.encode('utf-8')).hexdigest()

    # Step 3
    signing_key = get_signature_key(Amazon.secret_key, date_stamp, region, service)
    signature = hmac.new(signing_key, string_to_sign.encode('utf-8'), hashlib.sha256).hexdigest()
    authorization_header = algorithm + ' ' + 'Credential=' + Amazon.access_key + '/' + credential_scope +\
        ', ' + 'SignedHeaders=' + signed_headers + ', ' + 'Signature=' + signature

    backend.log.tts(text, voice)
    resp = http.request(
        "POST",
        endpoint,
        body=body.encode("utf-8"),
        headers={
            "Content-Type": "application/json",
            'X-Amz-Date': amz_date,
            'Authorization': authorization_header
        }
    )

    return resp.data


def download_resource(url, file_path):
    download_image(url, file_path)


def download_image(url, file_path):
    stdout = open(file_path, "wb")
    response = http.request("GET", url, preload_content=False)
    for chunk in response.stream(1024):
        stdout.write(chunk)
    response.release_conn()

    if response.status == 404:
        os.remove(file_path)
        return None
